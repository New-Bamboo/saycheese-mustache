<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Say Cheese - Mustachify</title>
  </head>

  <body>
    <div id="webcam-container"></div>
    <button id="snap" disabled>Snap!</button>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="https://raw.github.com/leemachin/say-cheese/master/say-cheese.js"></script>
    <script>
      var webcam = new SayCheese('#webcam-container');

      webcam.on('start', function() {
        $('#snap')
          .attr('disabled', false)
          .on('click', function() { return webcam.takeSnapshot() });
      });

      webcam.on('snapshot', function(evt, snapshot) {
        var req  = new XMLHttpRequest(),
            img  = snapshot.toDataURL('image/jpeg').split(',')[1]
;
        req.open('POST', '/image');

        req.onload = function(evt) {
          var url = this.response,
              img = document.createElement('img');

          img.onload = function() {
            return document.body.insertBefore(this, webcam.element);
          }

          img.src = url;
        };

        var data = new FormData();
        data.append('img', img);
        req.send(data);
      });

      webcam.start();
    </script>
  </body>
</html>
